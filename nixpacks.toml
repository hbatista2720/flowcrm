[phases.setup]
aptPkgs = [
  "ca-certificates", "fonts-liberation", "gconf-service", "libappindicator1", "libasound2", "libatk1.0-0", "libc6", "libcairo2", "libcups2", "libdbus-1-3", "libexpat1", "libfontconfig1", "libgbm1", "libgcc1", "libgconf-2-4", "libgdk-pixbuf2.0-0", "libglib2.0-0", "libgtk-3-0", "libnspr4", "libnss3", "libpango-1.0-0", "libpangocairo-1.0-0", "libstdc++6", "libx11-6", "libx11-xcb1", "libxcb1", "libxcomposite1", "libxcursor1", "libxdamage1", "libxext6", "libxfixes3", "libxi6", "libxrandr2", "libxrender1", "libxss1", "libxtst6", "lsb-release", "wget", "xdg-utils", "xvfb",
  "postgresql-client" # Added for pg_isready
]

[phases.build]
commands = [
  "set -ex", # Exit immediately if a command exits with a non-zero status.
  "echo 'Starting PostgreSQL wait loop...'",
  "until pg_isready -h postgres.railway.internal -p 5432 -U postgres -t 10; do echo 'PostgreSQL not ready yet, waiting 10 seconds...'; sleep 10; done",
  "echo 'PostgreSQL is ready. Proceeding with npm run build.'",
  "npm run build"
]
